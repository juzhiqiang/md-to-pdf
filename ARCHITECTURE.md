# ğŸ MD-to-PDF â€” é¡¹ç›®æ¶æ„æ–‡æ¡£

> **Tech Stack**: SolidJS Â· Tailwind CSS v4 Â· Less Â· BiomeJS v2.4 Â· pnpm Workspace Â· Turborepo
> **Type**: çº¯å®¢æˆ·ç«¯åº”ç”¨ (Zero Backend)
> **Design System**: ğŸ å“ç‰Œè®¾è®¡ç³»ç»Ÿ v1.0

---

## ç›®å½•ç»“æ„

```text
md-to-pdf/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/                          # ä¸»å‰ç«¯åº”ç”¨ (SolidJS + Vite)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ App.tsx               # ä¸»å…¥å£ï¼ŒçŠ¶æ€åè°ƒä¸åŒæ å¸ƒå±€
â”‚       â”‚   â”œâ”€â”€ index.tsx             # SolidJS æ¸²æŸ“å…¥å£
â”‚       â”‚   â”œâ”€â”€ index.css             # Tailwind v4 å…¨å±€æŒ‡ä»¤ä¸ä¸»é¢˜é…ç½®
â”‚       â”‚   â”œâ”€â”€ components/           # ä¸šåŠ¡ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ Editor/           # CodeMirror 6 ç¼–è¾‘å™¨ (æŒ‰éœ€åŠ è½½è¯­è¨€)
â”‚       â”‚   â”‚   â”œâ”€â”€ Preview/          # Markdown æ¸²æŸ“é¢„è§ˆåŒº
â”‚       â”‚   â”‚   â”œâ”€â”€ Toolbar/          # é¡¶éƒ¨åŠ¨ä½œæ  (å¯¼å‡º/å¤åˆ¶/æ¸…ç©º)
â”‚       â”‚   â”‚   â”œâ”€â”€ DropZone/         # åˆå§‹ä¸Šä¼ /æ‹–æ‹½/ç²˜è´´å¼•å¯¼åŒº
â”‚       â”‚   â”‚   â”œâ”€â”€ Skeleton/         # åŠ è½½éª¨æ¶å±
â”‚       â”‚   â”‚   â””â”€â”€ ExportSheet/      # å¯¼å‡ºè¯¦æƒ…é…ç½®é¢æ¿ (Apple é£æ ¼)
â”‚       â”‚   â””â”€â”€ styles/
â”‚       â”‚       â””â”€â”€ print.less        # @media print ä¸“ç”¨æ‰“å°æ ·å¼ä¼˜åŒ–
â”‚       â”œâ”€â”€ vite.config.ts            # Vite é…ç½® (å« manualChunks åˆ†åŒ…ç­–ç•¥)
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/                           # å…±äº« UI ç»„ä»¶åº“ (è·¨æ¡†æ¶é£æ ¼ç»Ÿä¸€)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/               # è¯­ä¹‰åŒ–æŒ‰é’® (æ”¯æŒ Loading/Icon/é€ä¼ )
â”‚   â”‚   â”‚   â”œâ”€â”€ Card/                 # äº¤äº’å¼å¡ç‰‡ (æ”¯æŒ A11y é”®ç›˜æ“ä½œ)
â”‚   â”‚   â”‚   â”œâ”€â”€ Toast/                # Dynamic Island é£æ ¼å…¨å±€é€šçŸ¥
â”‚   â”‚   â”‚   â””â”€â”€ index.ts              # ç»Ÿä¸€å¯¼å‡ºå…¥å£
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ core/                         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘åº“ (TypeScript)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ file.ts               # æ–‡ä»¶ç³»ç»Ÿ I/O (FileReader/Validator)
â”‚       â”‚   â”œâ”€â”€ markdown.ts           # è§£æå¼•æ“ (Marked + DOMPurify + Whitelist)
â”‚       â”‚   â”œâ”€â”€ pdf.ts                # PDF ç”Ÿæˆ (window.print å°è£… + å‰ªè´´æ¿)
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ biome.json                        # Biome é…ç½® (å« Tailwind v4 é€‚é…)
â”œâ”€â”€ turbo.json                        # Turborepo ä»»åŠ¡æµé…ç½®
â”œâ”€â”€ pnpm-workspace.yaml               # pnpm Monorepo æˆå‘˜å£°æ˜
â””â”€â”€ package.json                      # æ ¹ä¾èµ–ç®¡ç†
```

---

## æ ¸å¿ƒè®¾è®¡å†³ç­– (Architecture Decisions)

### 1. å“åº”å¼ä¸æ€§èƒ½ (SolidJS + manualChunks)
- **é›¶ Virtual DOM**: åˆ©ç”¨ SolidJS çš„ç»†ç²’åº¦å“åº”å¼ï¼Œç¡®ä¿åœ¨è¾“å…¥æµ·é‡ Markdown å†…å®¹æ—¶ï¼Œé¢„è§ˆåŒºçš„æ›´æ–°å¼€é”€æœ€å°ã€‚
- **åˆ†åŒ…ç­–ç•¥**: é’ˆå¯¹ CodeMirror æ ¸å¿ƒåº“åŠå…¶ 130+ è¯­è¨€åŒ…ï¼Œæˆ‘ä»¬åœ¨ `vite.config.ts` ä¸­é…ç½®äº† `manualChunks`ã€‚CodeMirror æ ¸å¿ƒè¢«æ‹†åˆ†ä¸ºç‹¬ç«‹ chunkï¼Œè€Œå…·ä½“è¯­è¨€åŒ…ï¼ˆå¦‚ JavaScript, Pythonï¼‰åˆ™é€šè¿‡ `LanguageDescription.of()` å®ç°**å…¨è‡ªåŠ¨åŠ¨æ€åŠ è½½**ï¼Œå¤§å¹…é™ä½äº†é¦–å± `DropZone` çš„ bundle ä½“ç§¯ã€‚

### 2. å®‰å…¨æ€§ä¿éšœ (XSS Defense)
- **å¤šå±‚é˜²æŠ¤**: `parseMarkdown` æµç¨‹é›†æˆäº† **DOMPurify** è¿›è¡Œ HTML æ¶ˆæ¯’ã€‚
- **æ²™ç®±åŒ–ä»£ç å—**: ä»£ç é«˜äº®æ¨¡å—é€šè¿‡ `safeLang()` æ­£åˆ™ç™½åå•è¿‡æ»¤ `lang` å‚æ•°ï¼Œé˜²æ­¢é€šè¿‡ Markdown å±æ€§æ³¨å…¥æ¶æ„è„šæœ¬ã€‚

### 3. å¯è®¿é—®æ€§ (Accessibility by Default)
- **è¯­ä¹‰åŒ–å¢å¼º**: æ‰€æœ‰äº¤äº’å…ƒç´ ï¼ˆå¦‚ `ExportSheet` é®ç½©ã€`Card`ï¼‰å‡å®ç°äº† `role="button"`ã€`tabIndex={0}` ä»¥åŠé”®ç›˜ `Enter/Space` äº‹ä»¶å¤„ç†ï¼Œç¡®ä¿å±å¹•é˜…è¯»å™¨å’Œé”®ç›˜ç”¨æˆ·ä½“éªŒã€‚
- **ARIA è§„èŒƒ**: è£…é¥°æ€§å›¾æ ‡ç»Ÿä¸€æ ‡è®° `aria-hidden="true"`ï¼Œäº¤äº’é¢æ¿ä½¿ç”¨ `role="dialog"` ä¸ `aria-modal`ã€‚

### 4. å¥å£®æ€§ä¸ç¨³å®šæ€§ (Robustness)
- **ç«æ€æ§åˆ¶**: `App.tsx` ä½¿ç”¨å¯å–æ¶ˆçš„ `loadingTimer` æœºåˆ¶ï¼Œé˜²æ­¢ç”±äºå¿«é€Ÿåˆ‡æ¢çŠ¶æ€å¯¼è‡´çš„å¼‚æ­¥å›è°ƒæ±¡æŸ“ã€‚
- **èµ„æºæ¸…ç†**: `ExportSheet` ç»„ä»¶å¼•å…¥äº† `safeTimeout` æ¨¡å¼ï¼Œåœ¨ç»„ä»¶å¸è½½æˆ–é¢æ¿å…³é—­æ—¶è‡ªåŠ¨æ¸…ç†æ‰€æœ‰æ´»è·ƒå®šæ—¶å™¨ï¼Œæœç»å†…å­˜æ³„æ¼å’Œæ„å¤–çŠ¶æ€æ›´æ–°ã€‚

### 5. æ ·å¼ç³»ç»Ÿ (Tailwind v4 + Design Tokens)
- **å…¨ CSS é©±åŠ¨**: é‡‡ç”¨ Tailwind v4ï¼Œç§»é™¤äº† JS é…ç½®æ–‡ä»¶ã€‚ä¸»é¢˜ Tokenï¼ˆé¢œè‰²ã€å­—ä½“ã€é˜´å½±ï¼‰åœ¨ `index.css` çš„ `@theme` å—ä¸­ç»Ÿä¸€å®šä¹‰ã€‚
- **æ‰“å°ä¼˜åŒ–**: `print.less` é€šè¿‡ `@media print` é’ˆå¯¹ A4 çº¸å¼ è¿›è¡Œæ’ç‰ˆç¼©æ”¾ã€èƒŒæ™¯ç€è‰²è¡¥å¿ï¼ˆ`print-color-adjust`ï¼‰ä»¥åŠéå¿…è¦å…ƒç´ ï¼ˆå¦‚æŒ‰é’®ï¼‰çš„è‡ªåŠ¨éšè—ã€‚

---

## æ ¸å¿ƒæŠ€æœ¯é“¾è·¯å›¾

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥: æ‹–æ‹½/ç²˜è´´/ç‚¹å‡»] --> B(@md-to-pdf/core: file.ts)
    B -->|æ ¼å¼æ ¡éªŒ| C{æ˜¯å¦åˆæ³•?}
    C -- å¦ --> D(UI: showToast æŠ¥é”™)
    C -- æ˜¯ --> E(App.tsx: è®¾ç½® Markdown çŠ¶æ€)
    E --> F(@md-to-pdf/core: markdown.ts)
    F -->|Marked è§£æ| G[HTML å­—ç¬¦ä¸²]
    G -->|DOMPurify æ¶ˆæ¯’| H[å®‰å…¨ HTML]
    H --> I(UI: Preview é¢„è§ˆå±•ç¤º)
    E --> J(UI: Editor å®æ—¶ç¼–è¾‘)
    K[å¯¼å‡ºæŒ‡ä»¤] --> L(@md-to-pdf/core: pdf.ts)
    L -->|window.print| M[ç”Ÿæˆé«˜æ¸… PDF]
```

---

## è´¨é‡é—¸é—¨ (Quality Gate)

é¡¹ç›®ä½¿ç”¨ **BiomeJS v2.4** ä½œä¸ºç»Ÿä¸€çš„å·¥å…·é“¾ï¼Œå…¶é…ç½®é‡ç‚¹åœ¨äºï¼š
- **Tailwind é€‚é…**: å¼€å¯ `css.parser.tailwindDirectives` ä»¥æ”¯æŒ v4 è¯­æ³•ã€‚
- **è§„åˆ™åˆ†çº§**: å°† `noImportantStyles` è®¾ä¸º `warn` ä»¥åŒ…å®¹æ‰“å°æ ·å¼çš„æ­£å¸¸éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒå…¶ä½™ Linter è§„åˆ™ä¸º `Error` çº§åˆ«ï¼Œç¡®ä¿ CI/CD æµç¨‹çš„ä¸¥è°¨ã€‚
